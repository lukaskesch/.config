# .bashrc

setopt nosharehistory

# zsh
alias zsh-reload='source ~/.zshrc'
alias zsh-config="nvim ~/.zshrc"

# Neovim
alias n='nvim'
alias nd='nvim .'
alias vi='nvim'
alias vim='nvim'

# Git aliases
alias g='git'
alias gs='git status'
alias gd='git diff'
alias gc='git commit -m'
alias ga='git add'
alias gaa='git add --all'
alias gac='git add --all && git commit -m'
alias gpl='git pull'
alias gps='git push'


# cd to selected directory
fd() {
  local dir
  dir=$(find ${1:-.} -path '*/\.*' -prune \
                  -o -type d -print 2> /dev/null | fzf +m) &&
  cd "$dir"
}

# Searching tmux session or create new if non exists
tfs() {
  [[ -n "$TMUX" ]] && change="switch-client" || change="attach-session"
  if [ $1 ]; then
    tmux $change -t "$1" 2>/dev/null || (tmux new-session -d -s $1 && tmux $change -t "$1"); return
  fi
  session=$(tmux list-sessions -F "#{session_name}" 2>/dev/null | fzf --exit-0) &&  tmux $change -t "$session" || echo "No sessions found."
}

# Creating new tmux session for selected directory
tns() {
    if [[ $# -eq 1 ]]; then
        selected=$1
    else
        selected=$(find ~/Documents/Programming ~/.config -mindepth 0 -maxdepth 2 -type d | fzf)
    fi

    selected_name=$(basename "$selected" | tr . _)
    tmux_running=$(pgrep tmux)

    if [[ -z $TMUX ]] && [[ -z $tmux_running ]]; then
        tmux new-session -s $selected_name -c $selected
        exit 0
    fi

    if ! tmux has-session -t=$selected_name 2> /dev/null; then
        tmux new-session -ds $selected_name -c $selected
    fi

    tmux switch-client -t $selected_name

    if [[ -z $TMUX ]]; then
        tmux attach-session -t $selected_name
    else
        tmux switch-client -t $selected_name
    fi
}

tmux-sessionizer () {
    if [[ $# -eq 1 ]]; then
        selected=$1
    else
        selected=$(find ~/work/builds ~/projects ~/ ~/work ~/personal ~/personal/yt -mindepth 1 -maxdepth 1 -type d | fzf)
    fi

    if [[ -z $selected ]]; then
        exit 0
    fi

    selected_name=$(basename "$selected" | tr . _)
    tmux_running=$(pgrep tmux)

    if [[ -z $TMUX ]] && [[ -z $tmux_running ]]; then
        tmux new-session -s $selected_name -c $selected
        exit 0
    fi

    if ! tmux has-session -t=$selected_name 2> /dev/null; then
        tmux new-session -ds $selected_name -c $selected
    fi

    tmux switch-client -t $selected_name
}

sc() {
    source ~/.zshrc
    tmux source-file ~/.config/tmux/tmux.conf
}

# Killing selected tmux session
# tk () {
#     local sessions
#     sessions="$(tmux ls|fzf --exit-0 --multi)"  || return $?
#     local i
#     for i in "${(f@)sessions}"
#     do
#         [[ $i =~ '([^:]*):.*' ]] && {
#             echo "Killing $match[1]"
#             tmux kill-session -t "$match[1]"
#         }
#     done
# }
#

# With `read -a` you can get the keycodes of the pressed keys
# Read `man zshzle` for more information about zle widgets

# Both approaches are valid
listFolders () { echo; ls; zle redisplay } 
zle -N listFolders
bindkey '^a' listFolders

bindkey -s ^f "tmux-sessionizer\n"

